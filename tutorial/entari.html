<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Entari | ArcletProject</title>
    <meta name="description" content="Document for ArcletProject">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/assets/style.DAt7IUCp.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.D7Aeh3Q1.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CLDkSDsq.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DCts17Kx.js">
    <link rel="modulepreload" href="/assets/tutorial_entari.md.CgTR1rDN.lean.js">
    <link rel="icon" href="/logo.png">
    <meta name="theme-color" content="#2564c2">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>ArcletProject</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tutorial/intro.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>入门</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>深入</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link" href="/appendices/WIP.html" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>开发指南</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ArcletProject" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>黑暗模式</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ArcletProject" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>目录</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-883964e0><button data-v-883964e0>回到顶部 ▲</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-edd2eed8><!----><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/intro.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>概览</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>教程</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-edd2eed8 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h3 class="text" data-v-edd2eed8>Alconna</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-edd2eed8><span class="vpi-chevron-right caret-icon" data-v-edd2eed8></span></div></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/alconna/v1.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>1.8</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/alconna/v2.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>2.0</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-edd2eed8 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h3 class="text" data-v-edd2eed8>NEPattern</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-edd2eed8><span class="vpi-chevron-right caret-icon" data-v-edd2eed8></span></div></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/nepattern/v0.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>0.6</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/nepattern/v1.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>1.0</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/cithun.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Cithub</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/letoderea.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Letoderea</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/entari.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Entari</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/tutorial/tarina.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Tarina</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>目录</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _tutorial_entari external-link-icon-enabled" data-v-e6f2a212><div><h1 id="entari" tabindex="-1">Entari <a class="header-anchor" href="#entari" aria-label="Permalink to &quot;Entari&quot;">​</a></h1><p><a href="https://github.com/ArcletProject/Entari" target="_blank" rel="noreferrer"><code>Entari</code></a> 是 <code>Arclet Project</code> 下一个基于 <a href="https://satori.js.org/" target="_blank" rel="noreferrer"><code>Satori</code></a> 协议的即时通信框架</p><p>其特点有：</p><ul><li>基于 Satori 协议，一份代码即可对接多种平台</li><li>异步并发，基于 Python 的异步特性，即使有大量的事件传入，也能吞吐自如</li><li>易上手的开发体验，没有过多的冗余代码，可以让开发者专注于业务逻辑</li><li>既可集成式也可分布式的配置文件，内建且可拓展的配置模型</li><li>可热重载的插件机制与服务机制，同时还能提供自定义事件</li><li>高度可拓展的事件响应器，能够依托强大的、符合直觉依赖注入进行会话控制</li><li>内置强大的命令系统、定时任务系统与多种插件</li></ul><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><p>基础安装 (只包含核心功能):</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-RCghY" id="tab-AhFdQn3" checked><label data-title="pdm" for="tab-AhFdQn3">pdm</label><input type="radio" name="group-RCghY" id="tab-0flIXGH"><label data-title="poetry" for="tab-0flIXGH">poetry</label><input type="radio" name="group-RCghY" id="tab-VFLMGlO"><label data-title="pip" for="tab-VFLMGlO">pip</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pdm</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">poetry</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari&quot;</span></span></code></pre></div></div></div><p>完整安装 (包含YAML支持，文件监听等):</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-_tshR" id="tab-6hOhLiL" checked><label data-title="pdm" for="tab-6hOhLiL">pdm</label><input type="radio" name="group-_tshR" id="tab--64-KKo"><label data-title="poetry" for="tab--64-KKo">poetry</label><input type="radio" name="group-_tshR" id="tab-kJEIxAA"><label data-title="pip" for="tab-kJEIxAA">pip</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pdm</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[full]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">poetry</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[full]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[full]&quot;</span></span></code></pre></div></div></div><h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><p>每个 Entari 应用都有一个配置文件，它管理了应用及其插件的全部配置。Entari 支持多种配置文件格式, 包括 <code>JSON</code> 和 <code>YAML</code> 等, 也支持直接在代码中配置。</p><p>安装后, 可以通过命令行工具 <code>entari</code> 来生成配置文件:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --help</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">用法:</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> config</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [-d] [-P NAMES]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">新建一个</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> Entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 配置文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">选项:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -d,</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --dev</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;">             是否生成开发用配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -P,</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --plugins</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> NAMES</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;">   指定增加哪些插件</span></span></code></pre></div><p><code>config new</code> 指令会根据当前环境选择一个合适的文件格式。 例如，若只进行了基础安装，则会生成一个 <code>.entari.json</code> 文件；若进行了完整安装，则会生成一个 <code>entari.yml</code> 文件。</p><p>以 <code>entari.yml</code> 为例, 生成的配置文件大致如下:</p><div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">basic</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  network</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> ws</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      host</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      port</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 5140</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;satori&quot;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  ignore_self_message</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  log_level</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> INFO</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  prefix</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  .record_message</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  ::echo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  ::inspect</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="基础配置" tabindex="-1">基础配置 <a class="header-anchor" href="#基础配置" aria-label="Permalink to &quot;基础配置&quot;">​</a></h3><p>这里我们先解释 <code>basic</code> 部分：</p><ul><li><code>network</code>: 网络配置, 可写多个网络配置 <ul><li><code>type</code>: 网络类型, 可填项有 <code>ws</code>, <code>websocket</code>, <code>wh</code>, <code>webhook</code></li><li><code>host</code>: satori 服务器地址</li><li><code>port</code>: satori 服务器端口</li><li><code>path</code>: satori 服务器路径</li></ul></li><li><code>ignore_self_message</code>: 是否忽略自己发送的消息事件</li><li><code>log_level</code>: 日志等级</li><li><code>prefix</code>: 指令前缀, 可留空</li></ul><p>另外还有未列出的基础配置项：</p><ul><li><code>log_ignores</code>: 日志忽略列表, 用于忽略特定路径的日志输出 (例如 <code>[&quot;aiosqlite.core&quot;]</code>)</li><li><code>skip_req_missing</code>: 是否在依赖缺失时跳过当前事件订阅者。参见 <a href="./letoderea.html#监听事件">监听事件</a> 的相关内容。</li><li><code>cmd_count</code>: 指令数量限制, 默认为 4096</li><li><code>external_dirs</code>: 外部目录, 用于加载不在安装环境中的插件 (例如自定义插件), 可留空</li></ul><h3 id="插件配置" tabindex="-1">插件配置 <a class="header-anchor" href="#插件配置" aria-label="Permalink to &quot;插件配置&quot;">​</a></h3><p><code>plugins</code> 部分用于配置插件, 它的每一个键对应于插件的名称，而值则对应于插件的配置。当没有进行配置时，值可以省略 (或者写成 {})。当存在配置时，值需要在插件的基础上缩进并写在接下来的几行中。例如：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  foo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    bar</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      key1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> value1</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      key2</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> value2</span></span></code></pre></div><p>插件名称通常对应于插件发布时的包名。当某个插件的名称形如 <code>entari-plugin-xxx</code> 时，可以省略 <code>entari_plugin_</code> 前缀，直接写成 <code>xxx</code>。</p><p>除了插件的包名外，插件的名称还可以有几种类型的前缀:</p><ul><li><code>::</code> 前缀表示内建插件。<code>::</code> 是对 <code>arclet.entari.builtins</code> 路径的省略。</li><li><code>.</code> 前缀表示特殊的 Rootless 插件，即不基于文件，而是通过一个函数定义的插件。它们通常用于一些简单的功能。</li><li><code>~</code> 前缀表示禁用插件。它的作用是将插件从配置中移除，而不是删除插件本身。</li></ul><p>除了插件包名，plugins 还支持一些特殊的配置项:</p><ul><li><code>$prelude</code>: 预加载插件列表。它的值是一个列表，包含了有必要先于其他插件加载的插件名称。</li><li><code>$files</code>: 额外的插件配置文件搜索目录。通过该配置项，你可以将部分插件配置放在其他文件中，并通过该配置项指定这些文件的路径。</li></ul><div class="tip custom-block"><p class="custom-block-title">自定义前缀</p><p>某些情况下，省略 <code>entari_plugin_</code> 前缀后的插件名称可能会与环境中的其他包名冲突。又或者，插件包名的前缀并不符合 <code>entari_plugin_</code> 的规范。 此时可以通过配置 <code>$prefix</code> 来指定插件的前缀：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  foo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    $prefix</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;entari_plugin_&quot;</span></span></code></pre></div></div><div class="tip custom-block"><p class="custom-block-title">自定义排序</p><p>有些插件需要在其他插件之前加载，但又不能作为预加载插件。这时可以通过配置 <code>$priority</code> 来指定插件的加载优先级:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  foo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    $priority</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 15</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  bar</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    $priority</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # bar 会在 foo 之前加载</span></span></code></pre></div><p><code>$priority</code> 的值越小，插件的加载优先级越高。默认情况下，所有插件的优先级为 16。</p></div><h2 id="运行" tabindex="-1">运行 <a class="header-anchor" href="#运行" aria-label="Permalink to &quot;运行&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>请确保在运行前已经运行了一个 <code>Satori</code> 服务器, 并且配置文件中的网络配置正确。</p><p>你可以通过如下途径搭建 Satori 服务器:</p><details class="details custom-block"><summary>方法</summary><ul><li>运行 Koishi 实例（搭配 @koishijs/plugin-server。藉此可以对接其他平台）</li><li>安装 <code>nekobox</code> 并运行 <code>nekobox run</code> 命令</li><li>安装 <code>entar-plugin-server</code> 插件，然后配置 <code>plugins.server</code>：<div class="language-yaml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  server</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    adapters</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">$path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> package.module:AdapterClass</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # Following are adapter&#39;s configuration</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">        key1</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> value1</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">        key2</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> value2</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    host</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    port</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 5140</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>此处的 <code>adapters</code> 可以参考 <a href="https://github.com/ArcletProject/entari-plugin-server#%E5%AE%98%E6%96%B9%E9%80%82%E9%85%8D%E5%99%A8" target="_blank" rel="noreferrer">适配器</a></li></ul></details></div><p>配置文件生成后, 可以直接通过指令运行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-28</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 23:18:35</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [core] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> xxxxx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">...</span></span></code></pre></div><p>或者使用指令 <code>entari gen_main</code>来生成一个 <code>main.py</code> 文件再运行:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> gen_main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Main</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> script</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> generated</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> at</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> main.py</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> python</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> main.py</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-28</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 23:18:35</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [core] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> xxxxx</span></span></code></pre></div><p>倘若你没有配置文件, 也可以直接在代码中创建一个 <code>Entari</code> 实例并运行:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">main.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;"> WS</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> load_plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">app </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    WS</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">host</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">5140</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;satori&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    ignore_self_message</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    log_level</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;INFO&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">load_plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;.record_message&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, {</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;record_send&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">load_plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;::echo&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">load_plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;::inspect&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">app</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>运行后，你便可以与机器人开始对话了。</p><section class="qq" data-v-a7e194e5><header class="qq-header" style="--qq-header-height:45px;" data-v-014fb637 data-v-a7e194e5><div class="qq-header__btn-bar" data-v-014fb637><span class="qq-header__btn red" data-v-014fb637></span><span class="qq-header__btn yellow" data-v-014fb637></span><span class="qq-header__btn green" data-v-014fb637></span></div><div class="qq-header__title" data-v-014fb637><!--[-->Entari Test<!--]--></div></header><main class="qq_container" data-v-ce48c77a data-v-a7e194e5><!--[--><!--[--><section class="message-container message-container--self message-container--align-right" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>A</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Alice</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--self" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->/echo -h<!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[--> echo &lt;...content&gt; <br> 显示消息 <br><br> 可用的选项有: <br> * 发送转义消息 <br>  --escape│-e <br> * 发送反转义消息 <br>  -E│--unescape <!--]--></span></div></div><!--]--></div></section><section class="message-container message-container--self message-container--align-right" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>A</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Alice</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--self" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->/echo hello world<!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->hello world<!--]--></span></div></div><!--]--></div></section><!--]--><!--]--></main></section><h2 id="插件" tabindex="-1">插件 <a class="header-anchor" href="#插件" aria-label="Permalink to &quot;插件&quot;">​</a></h2><p>如同配置文件一样，插件也是 Entari 的重要组成部分。它们可以扩展 Entari 的功能，提供更多的事件响应器、命令、定时任务等。 Entari 内置了一些插件，例如 <code>echo</code>、<code>inspect</code>、<code>help</code> 等。你可以在配置文件中启用它们，也可以通过代码加载它们。</p><p>想要创建一个新的插件，你可以使用 <code>entari plugin new</code> 命令来生成一个插件模板:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> plugin</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --help</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">用法:</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> plugin</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [-S] [-A] [-f]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">新建一个</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> Entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 插件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">选项:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -S,</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --static</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;">          是否为静态插件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -A,</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --application</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;">     是否为应用插件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -f,</span><span style="--shiki-light:#2B5581;--shiki-dark:#D19A66;"> --file</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;">            是否为单文件插件</span></span></code></pre></div><p>其中对于 <code>--application</code> 选项，若你正在新建单个插件项目，则忽略这个选项；若你正在创建一个本地插件，则需要使用这个选项。</p><p>假设我们通过 <code>entari plugin new my_plugin --application --file</code> 创建了一个名为 <code>my_plugin</code> 的插件，那么它的目录结构大致如下:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>project/</span></span>
<span class="line"><span>├── plugins/</span></span>
<span class="line"><span>│   └── my_plugin.py</span></span>
<span class="line"><span>└── entari.yml</span></span></code></pre></div><p>现在我们打开 <code>my_plugin.py</code> 文件，你会看到如下内容:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> metadata</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">metadata</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这就是一个最简单的插件，它只包含了一个 <code>metadata</code> 调用。<code>metadata</code> 函数用于设置插件的元数据，例如名称、版本、作者等。</p><h3 id="事件系统" tabindex="-1">事件系统 <a class="header-anchor" href="#事件系统" aria-label="Permalink to &quot;事件系统&quot;">​</a></h3><p><code>Entari</code> 的事件系统基于 <a href="./letoderea.html"><code>Letoderea</code></a>. 也就是说你可以直接按照 <a href="./letoderea.html#监听事件">监听事件</a> 的方式来注册事件监听器。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-C-7MV" id="tab-05iYBu3" checked><label data-title="通常形式" for="tab-05iYBu3">通常形式</label><input type="radio" name="group-C-7MV" id="tab-UgJJLQk"><label data-title="使用过滤器" for="tab-UgJJLQk">使用过滤器</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">letoderea </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> leto</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@leto</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message_created</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">letoderea </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> leto</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">letoderea </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> deref</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@leto</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@leto</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enter_if</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">deref</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_ping</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><p>上述代码片段实现了一个简单的功能：当任何用户发送 &quot;ping&quot; 时，机器人会回复 &quot;pong&quot;。</p><p>其中，我们注入了一个 <code>session</code> 参数，它是一个 <code>Session</code> 实例， 在这个例子中，我们通过它访问事件相关的数据 (使用 <code>session.content</code> 获取消息的内容)， 并调用其上的 API 作为对此事件的响应 (使用 <code>session.send()</code> 在当前频道内发送消息)。</p><p>除开使用 <code>letoderea.on</code>, 你还可以通过获取 <code>Plugin</code> 实例来注册事件监听器:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-7SGLD" id="tab-Nsz7_Xp" checked><label data-title="Plugin.current()" for="tab-Nsz7_Xp">Plugin.current()</label><input type="radio" name="group-7SGLD" id="tab-VJWDMKR"><label data-title="plugin" for="tab-VJWDMKR">plugin</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plug </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">current</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dispatch</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message_created</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 与 `on` 等价</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message_created</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div><p><code>Entari</code> 目前支持的事件有:</p><ul><li>所有隶属于 <code>Satori</code> 的事件, 例如 <code>MessageCreatedEvent</code>, <code>FriendRequestEvent</code> 等</li><li>生命周期事件: <code>Startup</code>, <code>Ready</code>, <code>Cleanup</code> 和 <code>AccountUpdate</code></li><li>插件事件: <code>PluginLoadedSuccess</code>, <code>PluginLoadedFailed</code>, <code>PluginUnloaded</code></li><li>消息发送事件: <code>SendRequest</code>, <code>SendResponse</code></li><li>插件配置事件: <code>ConfigReload</code></li><li>指令事件: <code>CommandExecute</code>, <code>CommandReceive</code>, <code>CommandParse</code>, <code>CommandOutput</code></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>你可以直接通过 <code>Entari.on_message()</code> 装饰器来注册一个最小的事件响应器:</p><details class="details custom-block"><summary>复读</summary><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">main.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;"> WS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">app </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WS</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">host</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">port</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">5140</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;satori&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@app</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on_message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> repeat</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(session.content)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">app</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></details></div><h3 id="指令系统" tabindex="-1">指令系统 <a class="header-anchor" href="#指令系统" aria-label="Permalink to &quot;指令系统&quot;">​</a></h3><p>一个机器人的绝大部分功能都是通过指令提供给用户的。Entari 的指令系统基于 <a href="./alconna/v1.html"><code>Alconna</code></a>，能够高效地处理大量消息的并发调用，同时还提供了快捷方式、调用前缀、速率限制、本地化等大量功能。 它本质上属于消息事件响应器的一个<a href="./letoderea.html#传播">前置传播者</a>，允许开发者通过定义指令来处理用户输入的命令。</p><p>指令的注册分为两种：</p><ul><li>通过 <code>command.on</code> 或 <code>command.command</code> 装饰器注册的指令</li><li>通过 <code>command.mount</code> 传入一个 Alconna 实例进行响应器注册</li></ul><p>对于一个简单的 <code>echo</code> 指令，你可以这样编写:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-0Egl5" id="tab-b9Bd2L3" checked><label data-title="command.on+str" for="tab-b9Bd2L3">command.on+str</label><input type="radio" name="group-0Egl5" id="tab-Cs5-hP9"><label data-title="command.command" for="tab-Cs5-hP9">command.command</label><input type="radio" name="group-0Egl5" id="tab-0yynfGW"><label data-title="command.on+Alconna" for="tab-0yynfGW">command.on+Alconna</label><input type="radio" name="group-0Egl5" id="tab-D4AnmdV"><label data-title="command.mount" for="tab-D4AnmdV">command.mount</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;echo </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{content}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> echo_</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> content</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;echo &lt;...content&gt;&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> echo_</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">Match</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">result</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">alconna </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Alconna</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Args</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> AllParam</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">alc </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Alconna</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;echo&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, Args[</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;content&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, AllParam])</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">alc</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> echo_</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">Match</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">result</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">alconna </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Alconna</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Args</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> AllParam</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">alc </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Alconna</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;echo&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, Args[</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;content&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, AllParam])</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">disp </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mount</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(alc)</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@disp</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">handle</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> echo_</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">Match</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">],</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(content.result)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><p>还记得 <code>prefix</code> 配置项吗？无论是 <code>command.on</code>, <code>command.command</code> 还是 <code>command.mount</code>, 它们都有三个通用的参数:</p><ul><li><code>need_reply_me</code>: 该指令是否需要回复机器人</li><li><code>need_notice_me</code>: 该指令是否需要 @ 机器人</li><li><code>use_config_prefix</code>: 是否使用配置文件中的前缀 (默认为 <code>True</code>)</li></ul><p>当我们配置了 <code>prefix</code> 时，Entari 会在指令触发后对消息内容进行处理，判断是否以配置的前缀开头，并去除前缀后再进行指令匹配。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>对于 <code>command.xxxx</code>, 其可以通过配置文件去设置全局性的指令配置项，例如 <code>need_reply_me</code> 和 <code>need_notice_me</code>。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  .commands</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    need_notice_me</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    use_config_prefix</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> false</span></span></code></pre></div></div><h3 id="配置模型" tabindex="-1">配置模型 <a class="header-anchor" href="#配置模型" aria-label="Permalink to &quot;配置模型&quot;">​</a></h3><p>我们已经知道了插件是可以接受配置的，那么如何在插件中使用配置呢？ <code>Entari</code> 提供了 <code>plugin_config</code> 函数来获取插件的配置。它会根据参数的不同返回不同的配置类型，即：</p><ul><li><code>plugin_config()</code> 返回插件的配置字典；</li><li><code>plugin_config(XXX)</code> 返回插件的配置模型 <code>XXX</code> 的实例。</li></ul><p>Entari 并未限制配置模型的类型，你可以使用任何注册了配置相关功能的配置模型类。 Entari 内建了如下模型类的支持：</p><ul><li><code>BasicConfModel</code>: 基于 <code>dataclass</code> 的 Entari 默认配置模型，支持简易的类型校验。</li><li><code>BaseModel</code>: 基于 <code>Pydantic</code> 的配置模型，从 <code>arclet.entari.config.models.pyd</code> 导入。</li><li><code>Struct</code>: 基于 <code>msgspec</code> 的配置模型，从 <code>arclet.entari.config.models.msgspec_</code> 导入。</li></ul><p>以 <code>BasicConfModel</code> 为例，我们可以这样定义一个配置模型:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> BasicConfModel</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> metadata</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin_config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyPluginConfig</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">BasicConfModel</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    foo</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    bar</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> int</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 42</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">metadata</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">config</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">MyPluginConfig)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">conf </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> plugin_config</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(MyPluginConfig)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在这个例子中，我们定义了一个名为 <code>MyPluginConfig</code> 的配置模型，它包含两个字段：<code>foo</code> 和 <code>bar</code>。其中 <code>bar</code> 有一个默认值 <code>42</code>。 当插件加载时，Entari 会自动读取配置文件中的 <code>my_plugin</code> 部分，并将其转换为 <code>MyPluginConfig</code> 的实例。</p><details class="details custom-block"><summary>配置文件示例</summary><p>假设我们在配置文件中添加了如下内容:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  my_plugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    foo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;Hello, World!&quot;</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    bar</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 100</span></span></code></pre></div><p>那么在插件加载后，<code>conf</code> 的值将是:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">&gt;&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;"> print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(conf)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MyPluginConfig</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">foo</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">bar</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><h3 id="生命周期" tabindex="-1">生命周期 <a class="header-anchor" href="#生命周期" aria-label="Permalink to &quot;生命周期&quot;">​</a></h3><p>上面提到过，Entari 提供了生命周期事件。这些事件会在某些 Entari 的运行阶段被触发，你可以通过监听它们来实现各种各样的功能。</p><ul><li><code>Startup</code>: 在 Entari 启动时触发。此时各种服务仍然处于准备阶段，尚未开始运行。你可以在这个事件中进行一些初始化操作，例如加载数据等。</li><li><code>Ready</code>: 在 Entari 准备就绪时触发。如果一个插件在加载时，Entari 已经处于 Ready 状态，则会对该插件立即触发 Ready 事件。建议在以下场景使用: <ul><li>需要在所有插件加载完成后进行一些操作</li><li>动态导入其他插件</li></ul></li><li><code>Cleanup</code>: 在 Entari 关闭时触发。此时所有服务正处于关闭阶段，你可以在这个事件中进行一些清理操作，例如保存数据等。</li><li><code>AccountUpdate</code>: 某个登陆号的状态发生变化时触发。你可以在这个事件中进行一些账号状态的更新操作，例如连接后主动发送消息等。</li></ul><p>对于监听生命周期事件，你可以导入 <code>arclet.entari.lifecycle</code> 模块中的事件类，并使用 <code>@on</code> 装饰器进行注册，或使用 <code>plugin.use</code> 装饰器进行注册。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-saHbO" id="tab-L9iwSdm" checked><label data-title="listen/dispatch" for="tab-L9iwSdm">listen/dispatch</label><input type="radio" name="group-saHbO" id="tab-FNWnvf3"><label data-title="plugin.use" for="tab-FNWnvf3">plugin.use</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">Ready</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_ready</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Entari is ready!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plug </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">current</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;::ready&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_ready</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Entari is ready!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><h3 id="副作用" tabindex="-1">副作用 <a class="header-anchor" href="#副作用" aria-label="Permalink to &quot;副作用&quot;">​</a></h3><p>Entari 支持在运行时卸载插件。你可以直接调用 <code>unload_plugin</code> 函数来卸载一个插件。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> unload_plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unload_plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这将会卸载名为 <code>my_plugin</code> 的插件，并触发 <code>PluginUnloaded</code> 事件。</p><p>Entari 的插件系统支持热重载，即任何一个插件可能在运行时被多次加载和卸载。要实现这一点，我们就必须在插件被卸载时清除它的所有副作用。</p><p>大部分情况下，Entari 会自动清除插件的副作用，例如事件监听器、指令、上游插件导入等。但是有些情况下，你可能需要手动清除副作用。这时候就需要通过 <code>collect_disposes</code> 方法来注册该插件的副作用清理函数。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> collect_disposes</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> xxx </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> global_list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 副作用</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">global_list</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清理副作用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">collect_disposes</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">lambda</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: global_list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">remove</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>然而，在某些情况下，我们需要确保一些数据在整个 Entari 运行期间保持不变。 这时可以使用 <code>keeping</code> 方法包装一个对象，使其在插件卸载时不会被清除。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> keeping</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">my_data </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> keeping</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_data&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, {</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;key&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">dispose</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">lambda</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: x.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clear</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">())</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样，即使 <code>my_plugin</code> 多次加载和卸载，<code>my_data</code> 内的数据也会保持不变。</p></div><h3 id="服务" tabindex="-1">服务 <a class="header-anchor" href="#服务" aria-label="Permalink to &quot;服务&quot;">​</a></h3><p>在 Entari 中，服务特指继承自 <code>launart.Service</code> 的类。它们依据 <a href="https://graia.cn/other/launart/" target="_blank" rel="noreferrer"><code>Launart</code></a> 的设计理念，提供了一种轻量级的服务注册和管理方式。 对于插件而言，它能通过服务向其他插件提供拓展功能。例如 <code>browser</code> 插件便启用了 <code>PlaywrightService</code> 服务来提供浏览器相关的功能。所有服务都能通过依赖注入的方式被其他插件使用。</p><p>在插件中定义的服务需要通过 <code>add_service</code> 方法记录下来。Entari 会在插件加载时自动注册这些服务，并在插件卸载时自动清理它们。</p><details class="details custom-block"><summary>服务示例</summary><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> launart </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Service</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Launart</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> add_service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 定义一个缓存服务</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CacheService</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Service</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">    id</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;my_cache_service&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;">property</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> required</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> set</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;">property</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> stages</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;blocking&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;cleanup&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;"> __init__</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;">        super</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">__init__</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">cache </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> key</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">cache</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(key)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> set</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> key</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;">        self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">cache</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">key</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> launch</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> manager</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Launart):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stage</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;blocking&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">            await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> manager</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">status</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wait_for_sigexit</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;"> self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">stage</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;cleanup&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#E5C07B;">            self</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">cache</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">clear</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注册服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add_service</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(CacheService)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>然后在其他插件中，你可以通过依赖注入直接获取这个服务:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">other_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> my_plugin </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> CacheService  </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># entari: plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message_created</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> cache_service</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> CacheService):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    cache_service</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(event.message_id, event.content)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details><h3 id="依赖与子插件" tabindex="-1">依赖与子插件 <a class="header-anchor" href="#依赖与子插件" aria-label="Permalink to &quot;依赖与子插件&quot;">​</a></h3><p>上面我们提到，一个插件可以依赖于其他插件（通过导入其他插件）。但是某些情况下，你导入的插件可能并未在配置文件中提及，即系统无法得知该导入是一个 Entari 插件。 针对这种情况，Entari 规定：通过 <code># entari: plugin</code> 注释来标记某些导入为 Entari 插件。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> other_plugin </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> some_function  </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># entari: plugin</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Entari 会自动记录插件之间的依赖关系。当一个上游插件被卸载时，Entari 会自动卸载所有依赖于它的下游插件。而当一个下游插件被卸载时，Entari 会自动清理仅有它依赖的上游插件。 例如，<code>bar</code> 依赖于 <code>foo</code>。当 <code>foo</code> 被卸载时，Entari 会自动卸载 <code>bar</code>。而当 <code>bar</code> 被卸载时，Entari 会检查 <code>foo</code> 是否还有其他下游插件依赖于它，如果没有，则会卸载 <code>foo</code>。</p><p>除了声明为插件外，Entari 还支持子插件的概念。子插件是指在一个插件中定义的其他插件，它们会跟随主插件的状态。同时，若子插件更新，主插件也会自动更新。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> foo </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;"> AAA</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # entari: subplugin</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> bar </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;"> BBB</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # entari: package</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#D19A66;">...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在这个例子中，<code>foo</code> 和 <code>bar</code> 都是子插件。Entari 会自动记录它们的状态，并在主插件被卸载时自动卸载它们。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>若某个插件属于目录结构，则其所有子目录下的 Python 文件都会被视为子插件。</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>my_plugin/</span></span>
<span class="line"><span>├── __init__.py</span></span>
<span class="line"><span>├── foo.py</span></span>
<span class="line"><span>├── bar.py</span></span>
<span class="line"><span>├── baz/</span></span>
<span class="line"><span>│   └── qux.py</span></span>
<span class="line"><span>└── quux.py</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在这个例子中，<code>my_plugin</code> 作为主插件，其下的 <code>foo.py</code>、<code>bar.py</code>、<code>baz/qux.py</code> 和 <code>quux.py</code> 都会被视为子插件。</p></div><h3 id="过滤器" tabindex="-1">过滤器 <a class="header-anchor" href="#过滤器" aria-label="Permalink to &quot;过滤器&quot;">​</a></h3><p>默认情况下，一个会话事件、中间件或者指令都对所有的会话生效。但如果我们希望这些功能只对部分群聊或者用户生效，我们就需要用到 <strong>过滤器</strong>。 过滤器的概念已经在 <a href="./letoderea.html#过滤器"><code>Letoderea</code></a> 中介绍过了。Entari 在此基础上提供了更为简洁的语法来使用过滤器。</p><p>Entari 的过滤器可以通过 <code>@filter_</code> 装饰器来使用:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> filter_</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@filter_</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">public</span><span style="--shiki-light:#24292EFF;--shiki-dark:#FFFFFF;"> &amp; filter_.user(&quot;123456789&quot;)  </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 只对公开群聊，并且用户 ID 为 123456789 的用户生效</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但是在源码中直接书写账号或群号会导致隐私泄露，并且其他用户无法使用你的插件。Entari 提供了在配置文件中定义过滤器的方式:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  my_plugin</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    $allow</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      public</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">      user</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;123456789&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">]</span></span></code></pre></div><p>这与上面的代码等价。Entari 会自动将配置文件中的过滤器转换为过滤器对象，并在运行时应用它们。</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>目前而言，这种写法并不是很方便。我们会在图形化界面实现后再来完善这个功能。</p></div><h2 id="消息链" tabindex="-1">消息链 <a class="header-anchor" href="#消息链" aria-label="Permalink to &quot;消息链&quot;">​</a></h2><p>一个聊天平台所能发送或接收的内容往往不只有纯文本。为此，我们引入了 <strong>消息元素 (Element)</strong> 和 <strong>消息链 (MessageChain)</strong> 的概念。</p><p>常见的消息元素有:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;123456789&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # @某个用户</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;all&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # @全体成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Image</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;https://vitepress.dev/vitepress-logo-mini.svg&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 图片</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Quote</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;xxxxx&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">content</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">])</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 引用某条消息</span></span></code></pre></div><section class="qq" data-v-a7e194e5><header class="qq-header" style="--qq-header-height:45px;" data-v-014fb637 data-v-a7e194e5><div class="qq-header__btn-bar" data-v-014fb637><span class="qq-header__btn red" data-v-014fb637></span><span class="qq-header__btn yellow" data-v-014fb637></span><span class="qq-header__btn green" data-v-014fb637></span></div><div class="qq-header__title" data-v-014fb637><!--[-->消息元素示例<!--]--></div></header><main class="qq_container" data-v-ce48c77a data-v-a7e194e5><!--[--><!--[--><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[--><a at>@123456789</a><!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[--><a at>@全体成员</a><!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-0945e2df><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container mix-message__container--pic container--others" data-v-0945e2df><!----><div class="message-content mix-message__inner" data-v-0945e2df><div class="image pic-element" style="--max-image-width:230px;--max-image-height:250px;" data-v-0945e2df><img src="https://vitepress.dev/vitepress-logo-mini.svg" alt="[图片]" class="image-content" data-v-0945e2df></div><!----></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-57c4891a><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container reply-message__container container--others" data-v-57c4891a><div class="message-content reply-message__inner" data-v-57c4891a><div class="reply-element nocopy" data-v-3a432c13 data-v-57c4891a><div class="reply-title" data-v-3a432c13><div class="reply-info" data-v-3a432c13><span class="qq-text-ellipsis" data-v-3a432c13></span></div></div><div class="reply-content" data-v-3a432c13><span class="mixed-container qq-text-ellipsis" data-v-3a432c13>原消息文本</span></div></div><span data-v-57c4891a><!--[-->Hello!<!--]--></span></div></div><!--]--></div></section><!--]--><!--]--></main></section><p>你可以在这里找到所有内建的消息元素：<a href="https://satori.js.org/zh-CN/protocol/elements.html" target="_blank" rel="noreferrer"><code>标准元素</code></a></p><p>而在此基础上，Entari 还提供了一个 <code>MessageChain</code> 类来表示一条消息。它可以包含多个消息元素，并且支持各种操作，例如拼接、转换等。</p><p>最基础的使用方式是直接将消息元素传入 <code>MessageChain</code> 的构造函数:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Image</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;123456789&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Image</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;https://example.com/image.png&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)])</span></span></code></pre></div><p><code>MessageChain</code> 还支持拼接操作:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;123456789&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Image</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;https://example.com/image.png&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>或者像列表一样使用 <code>append</code> 和 <code>extend</code> 方法:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Text</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">msg</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">extend</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">At</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;123456789&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Image</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;https://example.com/image.png&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)])</span></span></code></pre></div><p>而在处理收到的消息时，你同样可以使用 <code>MessageChain</code> 上的方法。</p><p>例如，例如，你想知道消息中是否包含图片，你可以这样做:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">answer1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Image </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">answer2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">has</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Image)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">answer3 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> bool</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(message.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">only</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Image))</span></span></code></pre></div><p>如果你想获取消息中的图片，你可以这样做:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">images1 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">Image</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">images2 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Image)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">images3 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">include</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Image)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">images4 </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">select</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Image)</span></span></code></pre></div><p>而后，如果你想提取图片中的链接，你可以这样做:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">urls </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> images1</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">lambda</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: x.src)</span></span></code></pre></div><h2 id="定时任务" tabindex="-1">定时任务 <a class="header-anchor" href="#定时任务" aria-label="Permalink to &quot;定时任务&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>该功能需要你安装额外依赖 (<strong>如果你是完整安装则忽略此提示</strong>):</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-XOs6z" id="tab-ObFo6QH" checked><label data-title="pdm" for="tab-ObFo6QH">pdm</label><input type="radio" name="group-XOs6z" id="tab-RG5jeea"><label data-title="poetry" for="tab-RG5jeea">poetry</label><input type="radio" name="group-XOs6z" id="tab-WTC602p"><label data-title="pip" for="tab-WTC602p">pip</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pdm</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[cron]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">poetry</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[cron]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[cron]&quot;</span></span></code></pre></div></div></div></div><p>Entari 内置了一个定时任务插件，允许你注册定时任务、周期任务和延时任务。</p><p>首先，你需要在配置文件中启用 <code>.scheduler</code> 插件:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  .scheduler</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> {}</span></span></code></pre></div><p>随后，导入 <code>arclet.entari.scheduler</code> 模块，并使用 <code>@cron</code>, <code>@every</code> 或 <code>@invoke</code> 装饰器来注册定时任务:</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-hS3-E" id="tab-L_99rcy" checked><label data-title="@cron" for="tab-L_99rcy">@cron</label><input type="radio" name="group-hS3-E" id="tab-MW-yMeJ"><label data-title="@every" for="tab-MW-yMeJ">@every</label><input type="radio" name="group-hS3-E" id="tab-5-OVnzf"><label data-title="@invoke" for="tab-5-OVnzf">@invoke</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> scheduler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@scheduler</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cron</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;0 0 * * *&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 每天午夜执行</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> daily_task</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;This task runs every day at midnight.&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> scheduler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@scheduler</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">every</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;minute&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 每5分钟执行一次</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> periodic_task</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">    print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;This task runs every 5 minutes.&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> scheduler</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;start&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        resp </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;This message will be deleted in 10 seconds.&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        @scheduler</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">invoke</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> delete_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">            await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">message_delete</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(resp[</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">].id)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">            print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Message deleted after 10 seconds.&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div></div><h2 id="数据存储" tabindex="-1">数据存储 <a class="header-anchor" href="#数据存储" aria-label="Permalink to &quot;数据存储&quot;">​</a></h2><p>部分情况下，我们需要在插件中存储一些数据，例如用户的个人信息、缓存、临时文件等。Entari 提供了一个简单的数据存储插件，用于获取指定的数据存储路径。</p><p>你可以在配置文件中启用 <code>.localdata</code> 插件:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  .localdata</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    use_global</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 是否使用全局数据存储路径</span></span></code></pre></div><p>localdata 的配置项包括:</p><ul><li><code>use_global</code>: 是否使用全局数据存储路径。默认为 <code>False</code>，表示使用运行实例的本地数据存储路径。</li><li><code>app_name</code>: 应用名称。默认为 <code>entari</code>。</li><li><code>base_dir</code>: 数据存储路径的基目录。默认为空，即使用 <code>app_name</code>。</li></ul><p>使用时，直接导入 <code>local_data</code>, 并使用其上的方法即可：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> local_data</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;save &lt;key&gt; &lt;value&gt;&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> save_data</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 保存数据到本地存储</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#E06C75;">    file</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> local_data</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get_data_file</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;my_plugin&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, key)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    with</span><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;"> open</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#E06C75;">file</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;w&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> f</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        f</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(value)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>localdata</code> 提供了以下方法:</p><ul><li><code>get_cache_dir</code>: 创建/获取缓存目录 <ul><li>本地路径为 <code>./.&lt;app_name&gt;/cache</code> 或 <code>./&lt;base_dir&gt;/cache</code></li><li>全局路径如下: <ul><li>macOS: <code>~/Library/Caches/&lt;app_name&gt;</code></li><li>Linux: <code>~/.cache/&lt;app_name&gt;</code></li><li>Windows: <code>C:\Users\&lt;username&gt;\AppData\Local\&lt;app_name&gt;\Cache</code></li></ul></li></ul></li><li><code>get_data_dir</code>: 创建/获取数据目录 <ul><li>本地路径为 <code>./.&lt;app_name&gt;/data</code> 或 <code>./&lt;base_dir&gt;/data</code></li><li>全局路径如下: <ul><li>macOS: <code>~/Library/Application Support/&lt;app_name&gt;</code></li><li>Linux: <code>~/.local/share/&lt;app_name&gt;</code></li><li>Windows: <code>C:\Users\&lt;username&gt;\AppData\Local\&lt;app_name&gt;</code></li></ul></li></ul></li><li><code>get_temp_dir</code>: 创建/获取临时目录; 一律为 <code>$TEMP/&lt;app_name&gt;_xxxx</code></li><li><code>get_xxxx_file</code>: 获取指定目录下的文件</li></ul><h2 id="热重载" tabindex="-1">热重载 <a class="header-anchor" href="#热重载" aria-label="Permalink to &quot;热重载&quot;">​</a></h2><p>Entari 支持热重载插件和配置文件。若需要启用该功能，你需要在配置文件中启用 <code>::auto_reload</code> 插件:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  ::auto_reload</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    watch_dirs</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;.&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    watch_config</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> true</span></span></code></pre></div><ul><li><code>watch_dirs</code> 用于指定需要监视的目录，默认为当前目录。</li><li><code>watch_config</code> 用于指定是否监视配置文件的变化，默认为 <code>False</code>。</li></ul><p>启用热重载后，Entari 会自动监视指定目录下的文件变化，并在文件变化时自动重载插件和配置文件。</p><details class="details custom-block"><summary>热重载示例</summary><p>假设我们在 <code>my_plugin.py</code> 中定义了一个插件，并启用了热重载:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当我们运行 Entari 后，如果我们修改了 <code>my_plugin.py</code> 文件并保存，Entari 会自动检测到文件变化，并重新加载该插件。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro has-diff vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">MessageCreatedEvent</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">content </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;ping&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line diff remove"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pong&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line diff add"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;pongpongpong!&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:44:14</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [core] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Entari</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 0.13.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:44:14</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> SUCCESS</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [plugin] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">loaded</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;arclet.entari.builtins.auto_reload&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:44:14</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> SUCCESS</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [plugin] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">loaded</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> plugin</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;my_plugin&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:45:07</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [message] [热重载测试] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Alice(@alice</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">) -</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;ping&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">...</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 修改 my_plugin.py 后</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:45:20</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> entari</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [AutoReload] Detected change in </span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&#39;my_plugin&#39;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">, reloading...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:45:20</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> entari</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [AutoReload] Reloaded </span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&#39;my_plugin&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-06-30</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 00:45:20</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [message] [热重载测试] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Alice(@alice</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">) -</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;ping&#39;</span></span></code></pre></div><section class="qq" data-v-a7e194e5><header class="qq-header" style="--qq-header-height:45px;" data-v-014fb637 data-v-a7e194e5><div class="qq-header__btn-bar" data-v-014fb637><span class="qq-header__btn red" data-v-014fb637></span><span class="qq-header__btn yellow" data-v-014fb637></span><span class="qq-header__btn green" data-v-014fb637></span></div><div class="qq-header__title" data-v-014fb637><!--[-->热重载测试<!--]--></div></header><main class="qq_container" data-v-ce48c77a data-v-a7e194e5><!--[--><!--[--><section class="message-container message-container--self message-container--align-right" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>A</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Alice</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--self" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->ping<!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->pong<!--]--></span></div></div><!--]--></div></section><div class="message__timestamp no-copy" data-v-e6e407a4><span class="babble" data-v-e6e407a4><!--[-->2025-06-30 00:45:20<!--]--></span></div><section class="message-container message-container--self message-container--align-right" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>A</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Alice</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--self" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->ping<!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->pongpongpong!<!--]--></span></div></div><!--]--></div></section><!--]--><!--]--></main></section></details><h2 id="数据库" tabindex="-1">数据库 <a class="header-anchor" href="#数据库" aria-label="Permalink to &quot;数据库&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>该功能需要你安装额外依赖 (<strong>如果你是完整安装则忽略此提示</strong>):</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-u_BN-" id="tab-Codk4WV" checked><label data-title="pdm" for="tab-Codk4WV">pdm</label><input type="radio" name="group-u_BN-" id="tab-3eXFjZR"><label data-title="poetry" for="tab-3eXFjZR">poetry</label><input type="radio" name="group-u_BN-" id="tab-wyab-gP"><label data-title="pip" for="tab-wyab-gP">pip</label></div><div class="blocks"><div class="language-bash vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pdm</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[database]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">poetry</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[database]&quot;</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;arclet-entari[database]&quot;</span></span></code></pre></div></div></div></div><p><code>Entari</code> 内置了一个数据库插件，允许你在插件中使用数据库进行数据存储和查询。</p><p>由于基于 <a href="https://www.sqlalchemy.org/" target="_blank" rel="noreferrer"><code>SQLAlchemy</code></a>，大部分情况下，你可以直接使用 SQLAlchemy 的 API 来操作数据库。</p><p>本插件只提供了 ORM 功能，没有数据库后端，也没有直接连接数据库后端的能力。 所以你需要另行安装数据库驱动和数据库后端，并且配置数据库连接信息。</p><h3 id="配置连接" tabindex="-1">配置连接 <a class="header-anchor" href="#配置连接" aria-label="Permalink to &quot;配置连接&quot;">​</a></h3><p>在配置文件中，你可以通过 <code>::database</code> 字段来配置数据库连接:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">entari.yml</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">basic</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  log_ignores</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;aiosqlite.core&quot;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">]  </span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 忽略 aiosqlite 的 DEBUG 日志</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">plugins</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">  ::database</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> sqlite</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 数据库类型, 可选值有 sqlite, mysql, postgresql 等</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> my_database.db</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 数据库名称或文件目录</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#E06C75;">    driver</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> aiosqlite</span><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 数据库驱动, 根据数据库类型选择</span></span>
<span class="line"><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">    ...</span></span></code></pre></div><p>其余的配置项包括:</p><ul><li><code>host</code>: 数据库主机地址 (仅在使用 MySQL/PostgreSQL 等远程数据库时需要)</li><li><code>port</code>: 数据库端口号 (仅在使用 MySQL/PostgreSQL 等远程数据库时需要)</li><li><code>username</code>: 数据库用户名 (仅在使用 MySQL/PostgreSQL 等远程数据库时需要)</li><li><code>password</code>: 数据库密码 (仅在使用 MySQL/PostgreSQL 等远程数据库时需要)</li><li><code>query</code>: 数据库连接参数 (仅在使用 MySQL/PostgreSQL 等远程数据库时需要)</li><li><code>options</code>: SQLAlchemy 的其他选项。参见 <a href="https://docs.sqlalchemy.org/en/21/core/engines.html#engine-creation-api" target="_blank" rel="noreferrer">Engine Creation API</a></li></ul><p>若不传入配置项，则默认使用 SQLite 数据库，并将数据库文件存储在当前目录下。</p><h3 id="定义模型" tabindex="-1">定义模型 <a class="header-anchor" href="#定义模型" aria-label="Permalink to &quot;定义模型&quot;">​</a></h3><p><code>database</code> 插件使用 SQLAlchemy 的 ORM 功能来定义模型。你可以通过继承 <code>database.Base</code> 类来定义你的模型类。</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">builtins</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">database </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Base</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Mapped</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> mapped_column</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Weather</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Base</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    __tablename__ </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;weather&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    location</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Mapped</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;">str</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> mapped_column</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">primary_key</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    weather</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Mapped</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;">str</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以用以下代码检查模型生成的数据库模式是否正确：</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> sqlalchemy</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">schema </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> CreateTable</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CreateTable</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Weather.__table__))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> weather</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    weather </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    CONSTRAINT</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> pk_weather </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">PRIMARY KEY</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">location</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="使用会话" tabindex="-1">使用会话 <a class="header-anchor" href="#使用会话" aria-label="Permalink to &quot;使用会话&quot;">​</a></h3><p><code>database</code> 插件通过 <code>SqlalchemyService</code> 提供数据库会话服务。</p><p>你可以通过依赖注入的方式获取 <code>SqlalchemyService</code> 实例，并使用它来获取数据库会话。</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-ios1U" id="tab-6mZTZi5" checked><label data-title="ORM" for="tab-6mZTZi5">ORM</label><input type="radio" name="group-ios1U" id="tab-QqsiqVB"><label data-title="SQL语句" for="tab-QqsiqVB">SQL语句</label></div><div class="blocks"><div class="language-python vp-adaptive-theme active line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">builtins</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">database </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> SqlalchemyService</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> sqlalchemy </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> select</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;get_weather </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{location}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">location</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> db</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> SqlalchemyService):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 在这里使用 SQLAlchemy 的会话进行数据库操作</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        result </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">scalars</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">select</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Weather).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">where</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(Weather.location </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;"> location))</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        data </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> result</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">all</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Data: </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">data</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> command</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">builtins</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">database </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> SqlalchemyService</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> sqlalchemy </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> text</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@command</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;get_weather </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{location}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> on_message</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">location</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#1976D2;--shiki-dark:#56B6C2;"> str</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> db</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> SqlalchemyService):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 在这里使用 SQLAlchemy 的会话进行数据库操作</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        result </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> db_session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">text</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;SELECT * FROM weather WHERE location=:location&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">), {</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;location&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">: location})</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        data </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> result</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchall</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> session</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Data: </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">data</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><p>关于如何使用 SQLAlchemy 的 ORM 功能，你可以参考 <a href="https://docs.sqlalchemy.org/en/21/orm/quickstart.html" target="_blank" rel="noreferrer">SQLAlchemy 官方文档</a>。</p><h2 id="钩子函数" tabindex="-1">钩子函数 <a class="header-anchor" href="#钩子函数" aria-label="Permalink to &quot;钩子函数&quot;">​</a></h2><p><code>Entari</code> 并没有提供钩子函数的概念，但是你可以通过监听特定的事件来实现类似的功能：</p><ul><li><code>PluginLoadedSuccess</code>: 当插件加载成功时触发。 <ul><li>可注入内容: <code>name: str</code> <strong>(建议直接注入事件本体)</strong></li></ul></li><li><code>PluginLoadedFailed</code>: 当插件加载失败时触发。 <ul><li>可注入内容: <code>name: str</code>, <code>error: Exception | None</code> <strong>(建议直接注入事件本体)</strong></li></ul></li><li><code>PluginUnloaded</code>: 当插件卸载时触发。 <ul><li>可注入内容: <code>name: str</code> <strong>(建议直接注入事件本体)</strong></li></ul></li><li><code>ConfigReload</code>: 当配置文件重新加载时触发。<strong>若监听器返回 <code>True</code>, 则不会继续执行后续的配置重载以及插件重载</strong>。 <ul><li>可注入内容: <code>scope: &quot;basic&quot; | &quot;plugin&quot;</code>, <code>key: str</code>, <code>value: Any, old: Any | None</code> <strong>(建议直接注入事件本体)</strong></li></ul></li><li><code>CommandReceive</code>: 指令在解析前触发。监听器可返回修改后的指令内容(类型要求为 <code>MessageChain</code>)。 <ul><li>可注入内容: <code>session: Session</code>, <code>command: Alconna</code>, <code>content: MessageChain</code>, <code>reply: Reply | None</code></li></ul></li><li><code>CommandParse</code>: 指令解析后触发。监听器可返回修改后的指令解析结果，<strong>或者返回 <code>False</code> 来阻止指令的执行</strong>。 <ul><li>可注入内容: <code>session: Session</code>, <code>command: Alconna</code>, <code>result: Arparma</code></li></ul></li><li><code>CommandOutput</code>: 指令的输出信息发送前触发。监听器可返回修改后的输出信息(类型要求为 <code>str | MessageChain</code>)，<strong>或者返回 <code>True/False</code> 来允许/阻止输出</strong>。 <ul><li>可注入内容: <code>session: Session</code>, <code>command: Alconna</code>, <code>type: &quot;help&quot; | &quot;shortcut&quot; | &quot;completion&quot; | &quot;error&quot;</code>, <code>content: str</code></li></ul></li><li><code>SendRequest</code>: 发送消息前触发。监听器可返回修改后的消息内容(类型要求为 <code>MessageChain</code>)，<strong>或者返回 <code>True/False</code> 来允许/阻止发送</strong>。 <ul><li>可注入内容: <code>account: Account</code>, <code>channel: str</code>, <code>message: MessageChain</code>, <code>session: Session | None</code></li></ul></li><li><code>SendResponse</code>: 发送消息后触发，仅可作为消息记录使用。 <ul><li>可注入内容: <code>account: Account</code>, <code>channel: str</code>, <code>message: MessageChain</code>, <code>result: list[MessageReceipt]</code>, <code>session: Session | None</code></li></ul></li></ul><details class="details custom-block"><summary>SendRequest 示例</summary><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plug </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">current</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;::before_send&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> send_hook</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> MessageChain):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> message </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &quot;喵&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><section class="qq" data-v-a7e194e5><header class="qq-header" style="--qq-header-height:45px;" data-v-014fb637 data-v-a7e194e5><div class="qq-header__btn-bar" data-v-014fb637><span class="qq-header__btn red" data-v-014fb637></span><span class="qq-header__btn yellow" data-v-014fb637></span><span class="qq-header__btn green" data-v-014fb637></span></div><div class="qq-header__title" data-v-014fb637><!--[-->Entari Test<!--]--></div></header><main class="qq_container" data-v-ce48c77a data-v-a7e194e5><!--[--><!--[--><section class="message-container message-container--self message-container--align-right" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>A</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Alice</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--self" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->/echo hello world<!--]--></span></div></div><!--]--></div></section><section class="message-container" data-v-e8e4e08e data-v-c26b7d0c><div class="qq-message__avatar-span" data-v-e8e4e08e><div class="qq-message__text-avatar" data-v-e8e4e08e><span data-v-e8e4e08e>E</span></div></div><div class="qq-message__user-name nocopy qq-text-ellipsis" data-v-e8e4e08e><span class="qq-text-ellipsis" data-v-e8e4e08e>Entari</span><!----><!----></div><div class="message-content__wrapper" data-v-e8e4e08e><!--[--><div class="msg-content-container mix-message__container container--others" data-v-c26b7d0c><div class="message-content mix-message__inner" style="--max-image-width:230px;--max-image-height:250px;" data-v-c26b7d0c><span data-v-c26b7d0c><!--[-->hello world喵<!--]--></span></div></div><!--]--></div></section><!--]--><!--]--></main></section></details><p>除此之外，你也可以通过 <code>Propagate</code> 配合 <code>PluginLoadedSuccess</code> 事件来为插件中的订阅者添加传播器。</p><details class="details custom-block"><summary>打印运行时间</summary><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">my_plugin.py</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> time</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> contextlib </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> asynccontextmanager</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">event</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plugin </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> PluginLoadedSuccess</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> arclet</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">entari</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plugin </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> get_plugin_subscribers</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">plug </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> Plugin</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">current</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@asynccontextmanager</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> record_running_time</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    start_time </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> time</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">time</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        yield</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    finally</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        end_time </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> time</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">time</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#56B6C2;">        print</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;">&quot;Running time: </span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">end_time </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;"> start_time</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">:.2f</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> seconds&quot;</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">@plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dispatch</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#212121;--shiki-dark:#61AFEF;">PluginLoadedSuccess</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> hook</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> PluginLoadedSuccess):</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> event</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">name </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">id</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">    subscribers </span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> get_plugin_subscribers</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(event.name)</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> sub </span><span style="--shiki-light:#D32F2F;--shiki-dark:#C678DD;">in</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> subscribers</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 副作用收集</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">        plug</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(sub.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">propagate</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">(record_running_time, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">prepend</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">True</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#212121;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">priority</span><span style="--shiki-light:#D32F2F;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#212121;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes min-light one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-08-04</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 15:49:31</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [message] [测时测试] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Alice(@alice</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;">) -</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;/read&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-08-04</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 15:49:31</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [message] [测时测试] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;example_plugin5.py reading&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">2025-08-04</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> 15:49:34</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#24292EFF;--shiki-dark:#ABB2BF;"> [message] [测时测试] </span><span style="--shiki-light:#D32F2F;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#22863A;--shiki-dark:#98C379;"> &#39;example_plugin5.py readed&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Running</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> time:</span><span style="--shiki-light:#1976D2;--shiki-dark:#D19A66;"> 3.03</span><span style="--shiki-light:#2B5581;--shiki-dark:#98C379;"> seconds</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>此处更推荐使用 <a href="./letoderea.html#传播集成">Propagator</a> 来实现功能，确保监控的订阅者是完整运行的。</p></div></details></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/ArcletProject/Documents/edit/main/tutorial/entari.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> 在 GitHub 编辑此页<!--]--></a></div><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>上次更新: <time datetime="2025-08-04T12:42:03.000Z" data-v-1bb0c8a8></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/tutorial/letoderea.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>上一页</span><span class="title" data-v-1bcd8184>Letoderea</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/tutorial/tarina.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>下一页</span><span class="title" data-v-1bcd8184>Tarina</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>MIT License</p><p class="copyright" data-v-566314d4>Copyright © 2025 ArcletProject</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"appendices_wip.md\":\"B8scjMVM\",\"index.md\":\"CNJBkCzU\",\"tutorial_alconna_index.md\":\"DglP0PVU\",\"tutorial_alconna_v1.md\":\"DMRZUVdP\",\"tutorial_alconna_v2.md\":\"fY91BNEy\",\"tutorial_cithun.md\":\"JOombMfu\",\"tutorial_entari.md\":\"CgTR1rDN\",\"tutorial_intro.md\":\"Cim2wJmv\",\"tutorial_letoderea.md\":\"B_notgLW\",\"tutorial_nepattern_index.md\":\"BArNYOWb\",\"tutorial_nepattern_v0.md\":\"Diy8NOSc\",\"tutorial_nepattern_v1.md\":\"HaRZQBIY\",\"tutorial_tarina.md\":\"xOGwCnJL\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"ArcletProject\",\"description\":\"Document for ArcletProject\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"nav\":[{\"text\":\"入门\",\"link\":\"/tutorial/intro.md\",\"activeMatch\":\"/tutorial/intro.md\"},{\"text\":\"深入\",\"items\":[{\"text\":\"开发指南\",\"link\":\"/appendices/WIP.md\",\"activeMatch\":\"/appendices/WIP.md\"}]}],\"sidebar\":{\"/tutorial/\":[{\"text\":\"\",\"items\":[{\"text\":\"概览\",\"link\":\"/tutorial/intro.md\"}]},{\"text\":\"教程\",\"items\":[{\"text\":\"Alconna\",\"collapsed\":true,\"items\":[{\"text\":\"1.8\",\"link\":\"/tutorial/alconna/v1.md\"},{\"text\":\"2.0\",\"link\":\"/tutorial/alconna/v2.md\"}]},{\"text\":\"NEPattern\",\"collapsed\":true,\"items\":[{\"text\":\"0.6\",\"link\":\"/tutorial/nepattern/v0.md\"},{\"text\":\"1.0\",\"link\":\"/tutorial/nepattern/v1.md\"}]},{\"text\":\"Cithub\",\"link\":\"/tutorial/cithun.md\"},{\"text\":\"Letoderea\",\"link\":\"/tutorial/letoderea.md\"},{\"text\":\"Entari\",\"link\":\"/tutorial/entari.md\"},{\"text\":\"Tarina\",\"link\":\"/tutorial/tarina.md\"}]}]},\"editLink\":{\"pattern\":\"https://github.com/ArcletProject/Documents/edit/main/:path\",\"text\":\"在 GitHub 编辑此页\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ArcletProject\"}],\"footer\":{\"message\":\"MIT License\",\"copyright\":\"Copyright © 2025 ArcletProject\"},\"lastUpdated\":{\"text\":\"上次更新\"},\"outline\":{\"label\":\"目录\",\"level\":[2,3]},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"search\":{\"provider\":\"local\"},\"darkModeSwitchLabel\":\"黑暗模式\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到黑暗模式\",\"sidebarMenuLabel\":\"目录\",\"returnToTopLabel\":\"回到顶部 ▲\",\"externalLinkIcon\":true},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>